<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 Snake - –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–≥—Ä–∞</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å –ò–≥—Ä—ã SDK -->
    <script src="/sdk.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: none;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #0a0e27, #1a1f3a);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .game-container {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            position: relative;
        }
        
        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0e27, #1a1f3a);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        
        .loading-logo {
            font-size: 36px;
            font-weight: 900;
            color: #00ffcc;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(0, 255, 204, 0.7);
            letter-spacing: 3px;
            animation: pulse 1.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { text-shadow: 0 0 20px rgba(0, 255, 204, 0.7); }
            to { text-shadow: 0 0 30px rgba(0, 255, 204, 0.9), 0 0 40px rgba(0, 255, 204, 0.5); }
        }
        
        .loading-container {
            width: 80%;
            max-width: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 204, 0.2);
        }
        
        .loading-text {
            text-align: center;
            color: #a0b3d3;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .progress-container {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00ffcc, #0099ff);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .loading-percentage {
            text-align: center;
            color: #00ffcc;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .loading-hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        /* –ú–µ–Ω—é —É—Ä–æ–≤–Ω–µ–π */
        .level-menu {
            background: rgba(16, 20, 40, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 255, 204, 0.3);
            text-align: center;
            display: none;
        }
        
        .menu-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 20px;
            color: #00ffcc;
            text-shadow: 0 0 15px rgba(0, 255, 204, 0.7);
            letter-spacing: 2px;
        }
        
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .level-button {
            aspect-ratio: 1/1;
            background: rgba(10, 15, 30, 0.7);
            border: 2px solid rgba(0, 153, 255, 0.3);
            border-radius: 10px;
            color: #0099ff;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .level-button.unlocked {
            background: linear-gradient(145deg, #00ffcc, #0099ff);
            color: #0a0e27;
            border-color: #00ffcc;
        }
        
        .level-button.unlocked:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 153, 255, 0.4);
        }
        
        .level-button.locked {
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .level-button.locked::after {
            content: "üîí";
            position: absolute;
            font-size: 24px;
        }
        
        .back-button {
            background: linear-gradient(145deg, #ff4e50, #f9d423);
            color: #0a0e27;
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 78, 80, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .back-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 78, 80, 0.6);
        }
        
        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        .start-screen {
            background: rgba(16, 20, 40, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 255, 204, 0.3);
            text-align: center;
            display: none;
        }
        
        .game-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 20px;
            color: #00ffcc;
            text-shadow: 0 0 15px rgba(0, 255, 204, 0.7);
            letter-spacing: 2px;
        }
        
        .game-subtitle {
            font-size: 18px;
            color: #0099ff;
            margin-bottom: 25px;
            font-weight: 500;
        }
        
        .rules {
            background: rgba(10, 15, 30, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(0, 153, 255, 0.2);
        }
        
        .rules h3 {
            color: #00ffcc;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }
        
        .rules ul {
            list-style-type: none;
            text-align: left;
        }
        
        .rules li {
            margin-bottom: 10px;
            color: #a0b3d3;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
        }
        
        .rules li::before {
            content: "‚ñ∂";
            color: #0099ff;
            margin-right: 10px;
            font-size: 12px;
        }
        
        .start-button {
            background: linear-gradient(145deg, #00ffcc, #0099ff);
            color: #0a0e27;
            border: none;
            border-radius: 30px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 153, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            max-width: 250px;
        }
        
        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 153, 255, 0.6);
        }
        
        .start-button:active {
            transform: translateY(1px);
        }
        
        /* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
        .game-screen {
            display: none;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(16, 20, 40, 0.7);
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 153, 255, 0.2);
        }
        
        .score-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .score-label {
            font-size: 14px;
            color: #a0b3d3;
            margin-bottom: 5px;
        }
        
        .score-value {
            font-size: 24px;
            font-weight: 700;
            color: #00ffcc;
        }
        
        .level-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .level-label {
            font-size: 14px;
            color: #a0b3d3;
            margin-bottom: 5px;
        }
        
        .level-value {
            font-size: 24px;
            font-weight: 700;
            color: #ff9a76;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .control-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(10, 15, 30, 0.7);
            border: 2px solid rgba(0, 153, 255, 0.3);
            color: #0099ff;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-button:hover {
            background: rgba(0, 153, 255, 0.2);
            border-color: #0099ff;
            transform: scale(1.1);
        }
        
        .game-board {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            background: rgba(10, 15, 30, 0.7);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 153, 255, 0.3);
            overflow: hidden;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }
        
        .game-over-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 30, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            z-index: 100;
            display: none;
        }
        
        .victory-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 30, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            z-index: 100;
            display: none;
        }
        
        .modal-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 15px;
        }
        
        .game-over-title {
            color: #ff4e50;
            text-shadow: 0 0 15px rgba(255, 78, 80, 0.7);
        }
        
        .victory-title {
            color: #00ffcc;
            text-shadow: 0 0 15px rgba(0, 255, 204, 0.7);
        }
        
        .modal-score {
            font-size: 24px;
            margin-bottom: 25px;
            color: #a0b3d3;
        }
        
        .modal-score span {
            color: #00ffcc;
            font-weight: 700;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .modal-button {
            background: linear-gradient(145deg, #ff4e50, #f9d423);
            color: #0a0e27;
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 78, 80, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .modal-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 78, 80, 0.6);
        }
        
        .next-level-button {
            background: linear-gradient(145deg, #00ffcc, #0099ff);
            color: #0a0e27;
            box-shadow: 0 5px 15px rgba(0, 153, 255, 0.4);
        }
        
        .next-level-button:hover {
            box-shadow: 0 8px 20px rgba(0, 153, 255, 0.6);
        }
        
        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 0;
            width: 100%;
            justify-content: center;
            z-index: 50;
        }
        
        .control-pad {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(3, 60px);
            gap: 5px;
        }
        
        .control-btn {
            background: rgba(16, 20, 40, 0.8);
            border: 2px solid rgba(0, 153, 255, 0.3);
            border-radius: 10px;
            color: #0099ff;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .control-btn:active {
            background: rgba(0, 153, 255, 0.3);
            transform: scale(0.95);
        }
        
        .control-btn.up { grid-column: 2; grid-row: 1; }
        .control-btn.left { grid-column: 1; grid-row: 2; }
        .control-btn.right { grid-column: 3; grid-row: 2; }
        .control-btn.down { grid-column: 2; grid-row: 3; }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
            }
            
            .game-title {
                font-size: 28px;
            }
            
            .game-subtitle {
                font-size: 16px;
            }
            
            .rules li {
                font-size: 12px;
            }
            
            .levels-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-height: 700px) {
            .game-container {
                transform: scale(0.9);
            }
        }
        
        @media (max-height: 600px) {
            .game-container {
                transform: scale(0.8);
            }
        }
        
        @media (max-height: 500px) {
            .game-container {
                transform: scale(0.7);
            }
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">2048 SNAKE</div>
        <div class="loading-container">
            <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="loading-percentage" id="loading-percentage">0%</div>
        </div>
    </div>
    
    <!-- –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="game-container">
        <!-- –ú–µ–Ω—é —É—Ä–æ–≤–Ω–µ–π -->
        <div class="level-menu" id="level-menu">
            <h1 class="menu-title">–í–´–ë–ï–†–ò–¢–ï –£–†–û–í–ï–ù–¨</h1>
            <div class="levels-grid" id="levels-grid">
                <!-- –ö–Ω–æ–ø–∫–∏ —É—Ä–æ–≤–Ω–µ–π –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é JavaScript -->
            </div>
            <button class="back-button" id="back-to-menu">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
        
        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
        <div class="start-screen" id="start-screen">
            <h1 class="game-title">2048 SNAKE</h1>
            <p class="game-subtitle">–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–≥—Ä–∞</p>
            <div class="rules">
                <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:</h3>
                <ul>
                    <li>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∑–º–µ–π–∫–æ–π —Å –ø–æ–º–æ—â—å—é —Å—Ç—Ä–µ–ª–æ–∫ –∏–ª–∏ —Å–≤–∞–π–ø–æ–≤</li>
                    <li>–°–æ–±–∏—Ä–∞–π—Ç–µ —è–±–ª–æ–∫–∏, —á—Ç–æ–±—ã —Ä–∞—Å—Ç–∏ –∏ –Ω–∞–±–∏—Ä–∞—Ç—å –æ—á–∫–∏</li>
                    <li>–ó–∞–Ω–∏–º–∞–π—Ç–µ –≤—Å–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∫–ª–µ—Ç–∫–∏, —á—Ç–æ–±—ã –ø–æ–±–µ–¥–∏—Ç—å</li>
                    <li>–ò–∑–±–µ–≥–∞–π—Ç–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏</li>
                    <li>–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —É—Ä–æ–≤–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ</li>
                </ul>
            </div>
            <button class="start-button" id="start-button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div class="game-screen" id="game-screen">
            <div class="game-header">
                <div class="score-container">
                    <div class="score-label">–°—á—ë—Ç</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="level-info">
                    <div class="level-label">–£—Ä–æ–≤–µ–Ω—å</div>
                    <div class="level-value" id="current-level">1</div>
                </div>
                <div class="controls">
                    <div class="control-button" id="pause-button">‚è∏</div>
                    <div class="control-button" id="restart-button">‚Üª</div>
                </div>
            </div>
            
            <div class="game-board" id="game-board">
                <canvas id="game-canvas"></canvas>
                
                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã -->
                <div class="game-over-modal" id="game-over-modal">
                    <div class="modal-title game-over-title">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</div>
                    <div class="modal-score">–í–∞—à —Å—á—ë—Ç: <span id="final-score">0</span></div>
                    <div class="modal-buttons">
                        <button class="modal-button" id="restart-modal-button">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                        <button class="modal-button" id="back-to-levels">–ö —É—Ä–æ–≤–Ω—è–º</button>
                    </div>
                </div>
                
                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥—ã -->
                <div class="victory-modal" id="victory-modal">
                    <div class="modal-title victory-title">–ü–æ–±–µ–¥–∞!</div>
                    <div class="modal-score">–í–∞—à —Å—á—ë—Ç: <span id="victory-score">0</span></div>
                    <div class="modal-buttons">
                        <button class="modal-button next-level-button" id="next-level-button">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å</button>
                        <button class="modal-button" id="back-to-levels-from-victory">–ö —É—Ä–æ–≤–Ω—è–º</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="mobile-controls">
        <div class="control-pad">
            <div class="control-btn up" data-direction="up">‚Üë</div>
            <div class="control-btn left" data-direction="left">‚Üê</div>
            <div class="control-btn right" data-direction="right">‚Üí</div>
            <div class="control-btn down" data-direction="down">‚Üì</div>
        </div>
    </div>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gridSize = 4;
        let cellSize = 40;
        let board = [];
        let snake = [];
        let snakeGrid = [];
        let obstacles = [];
        let obstacleGrid = [];
        let direction = 'right';
        let nextDirection = 'right';
        let score = 0;
        let bestScore = localStorage.getItem('bestScore') || 0;
        let gameRunning = false;
        let gamePaused = false;
        let gameSpeed = 400; // –°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –∑–º–µ–π–∫–∏
        let animationSpeed = 50; // –°–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –º–µ–∂–¥—É –∫–ª–µ—Ç–∫–∞–º–∏
        let gameInterval = null;
        let animationInterval = null;
        let currentLevel = 1;
        let maxUnlockedLevel = parseInt(localStorage.getItem('maxUnlockedLevel')) || 1;
        let canvas, ctx;
        let moveProgress = 0; // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (0-1)
        let headMoveProgress = 0; // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≥–æ–ª–æ–≤—ã (0-1)
        let targetPositions = []; // –¶–µ–ª–µ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        let isMoving = false; // –§–ª–∞–≥ –¥–≤–∏–∂–µ–Ω–∏—è –∑–º–µ–π–∫–∏
        let pendingAppleCheck = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —è–±–ª–æ–∫–∞ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
        let pendingVictoryCheck = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–±–µ–¥—ã –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
        let inputBuffer = []; // –ë—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–∂–∞—Ç–∏–π
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –Ø–Ω–¥–µ–∫—Å –ò–≥—Ä SDK
        let ysdk = null;
        let player = null;
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
        const levelConfig = [
            { 
                level: 1, 
                gridSize: 4, 
                obstacles: [] // –£—Ä–æ–≤–µ–Ω—å 1 –±–µ–∑ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            },
            { 
                level: 2, 
                gridSize: 4, 
                obstacles: [
                    { row: 1, col: 1 } // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –≤ —Ü–µ–Ω—Ç—Ä–µ
                ] 
            },
            { 
                level: 3, 
                gridSize: 4, 
                obstacles: [
                    { row: 0, col: 2 },
                    { row: 2, col: 1 }
                ] 
            },
            { 
                level: 4, 
                gridSize: 4, 
                obstacles: [
                    { row: 0, col: 0 },
                    { row: 0, col: 3 },
                    { row: 3, col: 0 }
                ] 
            },
            { 
                level: 5, 
                gridSize: 4, 
                obstacles: [
                    { row: 1, col: 1 },
                    { row: 1, col: 2 },
                    { row: 2, col: 1 },
                    { row: 2, col: 2 }
                ] 
            },
            { 
                level: 6, 
                gridSize: 6, 
                obstacles: [
                    { row: 1, col: 1 },
                    { row: 1, col: 4 },
                    { row: 4, col: 1 }
                ] 
            },
            { 
                level: 7, 
                gridSize: 6, 
                obstacles: [
                    { row: 0, col: 2 },
                    { row: 1, col: 1 },
                    { row: 1, col: 4 },
                    { row: 2, col: 0 },
                    { row: 4, col: 3 },
                    { row: 5, col: 5 }
                ] 
            },
            { 
                level: 8, 
                gridSize: 6, 
                obstacles: [
                    { row: 0, col: 0 },
                    { row: 0, col: 5 },
                    { row: 2, col: 2 },
                    { row: 2, col: 3 },
                    { row: 3, col: 2 },
                    { row: 3, col: 3 },
                    { row: 5, col: 0 },
                    { row: 5, col: 5 },
                    { row: 1, col: 1 }
                ] 
            },
            { 
                level: 9, 
                gridSize: 6, 
                obstacles: [
                    { row: 0, col: 1 },
                    { row: 0, col: 4 },
                    { row: 1, col: 0 },
                    { row: 1, col: 5 },
                    { row: 4, col: 0 },
                    { row: 4, col: 5 },
                    { row: 5, col: 1 },
                    { row: 5, col: 4 },
                    { row: 2, col: 2 },
                    { row: 2, col: 3 },
                    { row: 3, col: 2 },
                    { row: 3, col: 3 }
                ] 
            },
            { 
                level: 10, 
                gridSize: 6, 
                obstacles: [
                    { row: 0, col: 0 },
                    { row: 0, col: 2 },
                    { row: 0, col: 4 },
                    { row: 2, col: 0 },
                    { row: 2, col: 5 },
                    { row: 3, col: 0 },
                    { row: 3, col: 5 },
                    { row: 5, col: 1 },
                    { row: 5, col: 3 },
                    { row: 5, col: 5 },
                    { row: 1, col: 2 },
                    { row: 1, col: 3 },
                    { row: 4, col: 2 },
                    { row: 4, col: 3 },
                    { row: 2, col: 2 }
                ] 
            },
            { 
                level: 11, 
                gridSize: 8, 
                obstacles: [
                    { row: 1, col: 1 },
                    { row: 1, col: 6 },
                    { row: 3, col: 3 },
                    { row: 3, col: 4 },
                    { row: 6, col: 1 },
                    { row: 6, col: 6 },
                    { row: 2, col: 2 },
                    { row: 5, col: 5 }
                ] 
            },
            { 
                level: 12, 
                gridSize: 8, 
                obstacles: [
                    { row: 0, col: 0 },
                    { row: 0, col: 7 },
                    { row: 1, col: 1 },
                    { row: 1, col: 6 },
                    { row: 2, col: 2 },
                    { row: 2, col: 5 },
                    { row: 3, col: 3 },
                    { row: 3, col: 4 },
                    { row: 4, col: 3 },
                    { row: 4, col: 4 },
                    { row: 5, col: 2 },
                    { row: 5, col: 5 },
                    { row: 6, col: 1 },
                    { row: 6, col: 6 },
                    { row: 7, col: 0 },
                    { row: 7, col: 7 }
                ] 
            },
            { 
                level: 13, 
                gridSize: 8, 
                obstacles: [
                    { row: 0, col: 2 },
                    { row: 0, col: 5 },
                    { row: 1, col: 1 },
                    { row: 1, col: 6 },
                    { row: 2, col: 0 },
                    { row: 2, col: 3 },
                    { row: 2, col: 4 },
                    { row: 2, col: 7 },
                    { row: 3, col: 2 },
                    { row: 3, col: 5 },
                    { row: 4, col: 2 },
                    { row: 4, col: 5 },
                    { row: 5, col: 0 },
                    { row: 5, col: 3 },
                    { row: 5, col: 4 },
                    { row: 5, col: 7 },
                    { row: 6, col: 1 },
                    { row: 6, col: 6 },
                    { row: 7, col: 2 },
                    { row: 7, col: 5 },
                    { row: 3, col: 1 },
                    { row: 3, col: 6 },
                    { row: 4, col: 1 },
                    { row: 4, col: 6 }
                ] 
            },
            { 
                level: 14, 
                gridSize: 8, 
                obstacles: [
                    { row: 0, col: 0 },
                    { row: 0, col: 2 },
                    { row: 0, col: 4 },
                    { row: 0, col: 6 },
                    { row: 1, col: 1 },
                    { row: 1, col: 3 },
                    { row: 1, col: 5 },
                    { row: 1, col: 7 },
                    { row: 2, col: 0 },
                    { row: 2, col: 2 },
                    { row: 2, col: 4 },
                    { row: 2, col: 6 },
                    { row: 3, col: 1 },
                    { row: 3, col: 3 },
                    { row: 3, col: 5 },
                    { row: 3, col: 7 },
                    { row: 4, col: 0 },
                    { row: 4, col: 2 },
                    { row: 4, col: 4 },
                    { row: 4, col: 6 },
                    { row: 5, col: 1 },
                    { row: 5, col: 3 },
                    { row: 5, col: 5 },
                    { row: 5, col: 7 },
                    { row: 6, col: 0 },
                    { row: 6, col: 2 },
                    { row: 6, col: 4 },
                    { row: 6, col: 6 },
                    { row: 7, col: 1 },
                    { row: 7, col: 3 },
                    { row: 7, col: 5 },
                    { row: 7, col: 7 }
                ] 
            },
            { 
                level: 15, 
                gridSize: 8, 
                obstacles: [
                    { row: 0, col: 1 },
                    { row: 0, col: 3 },
                    { row: 0, col: 5 },
                    { row: 1, col: 0 },
                    { row: 1, col: 2 },
                    { row: 1, col: 4 },
                    { row: 1, col: 6 },
                    { row: 2, col: 1 },
                    { row: 2, col: 3 },
                    { row: 2, col: 5 },
                    { row: 2, col: 7 },
                    { row: 3, col: 0 },
                    { row: 3, col: 2 },
                    { row: 3, col: 4 },
                    { row: 3, col: 6 },
                    { row: 4, col: 1 },
                    { row: 4, col: 3 },
                    { row: 4, col: 5 },
                    { row: 4, col: 7 },
                    { row: 5, col: 0 },
                    { row: 5, col: 2 },
                    { row: 5, col: 4 },
                    { row: 5, col: 6 },
                    { row: 6, col: 1 },
                    { row: 6, col: 3 },
                    { row: 6, col: 5 },
                    { row: 7, col: 2 },
                    { row: 7, col: 4 },
                    { row: 7, col: 6 },
                    { row: 0, col: 7 },
                    { row: 6, col: 0 },
                    { row: 6, col: 7 },
                    { row: 7, col: 0 },
                    { row: 7, col: 1 },
                    { row: 7, col: 7 }
                ] 
            },
            { 
                level: 16, 
                gridSize: 10, 
                obstacles: [
                    { row: 1, col: 1 },
                    { row: 1, col: 8 },
                    { row: 3, col: 3 },
                    { row: 3, col: 6 },
                    { row: 5, col: 4 },
                    { row: 5, col: 5 },
                    { row: 8, col: 1 },
                    { row: 8, col: 8 },
                    { row: 2, col: 2 },
                    { row: 2, col: 7 },
                    { row: 7, col: 2 },
                    { row: 7, col: 7 },
                    { row: 4, col: 1 },
                    { row: 4, col: 8 },
                    { row: 1, col: 4 },
                    { row: 1, col: 5 }
                ] 
            },
            { 
                level: 17, 
                gridSize: 10, 
                obstacles: [
                    { row: 0, col: 0 },
                    { row: 0, col: 9 },
                    { row: 1, col: 1 },
                    { row: 1, col: 8 },
                    { row: 2, col: 2 },
                    { row: 2, col: 7 },
                    { row: 3, col: 3 },
                    { row: 3, col: 6 },
                    { row: 4, col: 4 },
                    { row: 4, col: 5 },
                    { row: 5, col: 4 },
                    { row: 5, col: 5 },
                    { row: 6, col: 3 },
                    { row: 6, col: 6 },
                    { row: 7, col: 2 },
                    { row: 7, col: 7 },
                    { row: 8, col: 1 },
                    { row: 8, col: 8 },
                    { row: 9, col: 0 },
                    { row: 9, col: 9 },
                    { row: 1, col: 4 },
                    { row: 1, col: 5 },
                    { row: 8, col: 4 },
                    { row: 8, col: 5 },
                    { row: 4, col: 1 },
                    { row: 4, col: 8 },
                    { row: 5, col: 1 },
                    { row: 5, col: 8 }
                ] 
            },
            { 
                level: 18, 
                gridSize: 10, 
                obstacles: [
                    { row: 0, col: 2 },
                    { row: 0, col: 7 },
                    { row: 1, col: 1 },
                    { row: 1, col: 8 },
                    { row: 2, col: 0 },
                    { row: 2, col: 3 },
                    { row: 2, col: 6 },
                    { row: 2, col: 9 },
                    { row: 3, col: 2 },
                    { row: 3, col: 7 },
                    { row: 4, col: 1 },
                    { row: 4, col: 4 },
                    { row: 4, col: 5 },
                    { row: 4, col: 8 },
                    { row: 5, col: 1 },
                    { row: 5, col: 4 },
                    { row: 5, col: 5 },
                    { row: 5, col: 8 },
                    { row: 6, col: 2 },
                    { row: 6, col: 7 },
                    { row: 7, col: 0 },
                    { row: 7, col: 3 },
                    { row: 7, col: 6 },
                    { row: 7, col: 9 },
                    { row: 8, col: 1 },
                    { row: 8, col: 8 },
                    { row: 9, col: 2 },
                    { row: 9, col: 7 },
                    { row: 3, col: 4 },
                    { row: 3, col: 5 },
                    { row: 6, col: 4 },
                    { row: 6, col: 5 },
                    { row: 1, col: 4 },
                    { row: 1, col: 5 },
                    { row: 8, col: 4 },
                    { row: 8, col: 5 }
                ] 
            },
            { 
                level: 19, 
                gridSize: 10, 
                obstacles: [
                    { row: 0, col: 0 },
                    { row: 0, col: 2 },
                    { row: 0, col: 4 },
                    { row: 0, col: 6 },
                    { row: 0, col: 8 },
                    { row: 1, col: 1 },
                    { row: 1, col: 3 },
                    { row: 1, col: 5 },
                    { row: 1, col: 7 },
                    { row: 1, col: 9 },
                    { row: 2, col: 0 },
                    { row: 2, col: 2 },
                    { row: 2, col: 4 },
                    { row: 2, col: 6 },
                    { row: 2, col: 8 },
                    { row: 3, col: 1 },
                    { row: 3, col: 3 },
                    { row: 3, col: 5 },
                    { row: 3, col: 7 },
                    { row: 3, col: 9 },
                    { row: 4, col: 0 },
                    { row: 4, col: 2 },
                    { row: 4, col: 4 },
                    { row: 4, col: 6 },
                    { row: 4, col: 8 },
                    { row: 5, col: 1 },
                    { row: 5, col: 3 },
                    { row: 5, col: 5 },
                    { row: 5, col: 7 },
                    { row: 5, col: 9 },
                    { row: 6, col: 0 },
                    { row: 6, col: 2 },
                    { row: 6, col: 4 },
                    { row: 6, col: 6 },
                    { row: 6, col: 8 },
                    { row: 7, col: 1 },
                    { row: 7, col: 3 },
                    { row: 7, col: 5 },
                    { row: 7, col: 7 },
                    { row: 7, col: 9 },
                    { row: 8, col: 0 },
                    { row: 8, col: 2 },
                    { row: 8, col: 4 },
                    { row: 8, col: 6 },
                    { row: 8, col: 8 },
                    { row: 9, col: 1 },
                    { row: 9, col: 3 },
                    { row: 9, col: 5 },
                    { row: 9, col: 7 }
                ] 
            },
            { 
                level: 20, 
                gridSize: 10, 
                obstacles: [
                    { row: 0, col: 1 },
                    { row: 0, col: 3 },
                    { row: 0, col: 5 },
                    { row: 0, col: 7 },
                    { row: 1, col: 0 },
                    { row: 1, col: 2 },
                    { row: 1, col: 4 },
                    { row: 1, col: 6 },
                    { row: 1, col: 8 },
                    { row: 2, col: 1 },
                    { row: 2, col: 3 },
                    { row: 2, col: 5 },
                    { row: 2, col: 7 },
                    { row: 2, col: 9 },
                    { row: 3, col: 0 },
                    { row: 3, col: 2 },
                    { row: 3, col: 4 },
                    { row: 3, col: 6 },
                    { row: 3, col: 8 },
                    { row: 4, col: 1 },
                    { row: 4, col: 3 },
                    { row: 4, col: 5 },
                    { row: 4, col: 7 },
                    { row: 4, col: 9 },
                    { row: 5, col: 0 },
                    { row: 5, col: 2 },
                    { row: 5, col: 4 },
                    { row: 5, col: 6 },
                    { row: 5, col: 8 },
                    { row: 6, col: 1 },
                    { row: 6, col: 3 },
                    { row: 6, col: 5 },
                    { row: 6, col: 7 },
                    { row: 6, col: 9 },
                    { row: 7, col: 0 },
                    { row: 7, col: 2 },
                    { row: 7, col: 4 },
                    { row: 7, col: 6 },
                    { row: 7, col: 8 },
                    { row: 8, col: 1 },
                    { row: 8, col: 3 },
                    { row: 8, col: 5 },
                    { row: 8, col: 7 },
                    { row: 9, col: 2 },
                    { row: 9, col: 4 },
                    { row: 9, col: 6 },
                    { row: 9, col: 8 },
                    { row: 0, col: 9 },
                    { row: 9, col: 0 },
                    { row: 9, col: 9 },
                    { row: 0, col: 0 },
                    { row: 3, col: 9 },
                    { row: 6, col: 0 }
                ] 
            }
        ];
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        let loadingScreen, startScreen, gameScreen, levelMenu, levelsGrid;
        let startButton, pauseButton, restartButton, restartModalButton, nextLevelButton;
        let backToMenuButton, backToLevelsButton, backToLevelsFromVictoryButton;
        let scoreElement, currentLevelElement, finalScoreElement, victoryScoreElement;
        let gameOverModal, victoryModal, gameBoard, progressBar, loadingPercentage;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function initDOMElements() {
            loadingScreen = document.getElementById('loading-screen');
            startScreen = document.getElementById('start-screen');
            gameScreen = document.getElementById('game-screen');
            levelMenu = document.getElementById('level-menu');
            levelsGrid = document.getElementById('levels-grid');
            startButton = document.getElementById('start-button');
            pauseButton = document.getElementById('pause-button');
            restartButton = document.getElementById('restart-button');
            restartModalButton = document.getElementById('restart-modal-button');
            nextLevelButton = document.getElementById('next-level-button');
            backToMenuButton = document.getElementById('back-to-menu');
            backToLevelsButton = document.getElementById('back-to-levels');
            backToLevelsFromVictoryButton = document.getElementById('back-to-levels-from-victory');
            scoreElement = document.getElementById('score');
            currentLevelElement = document.getElementById('current-level');
            finalScoreElement = document.getElementById('final-score');
            victoryScoreElement = document.getElementById('victory-score');
            gameOverModal = document.getElementById('game-over-modal');
            victoryModal = document.getElementById('victory-modal');
            gameBoard = document.getElementById('game-board');
            progressBar = document.getElementById('progress-bar');
            loadingPercentage = document.getElementById('loading-percentage');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å –ò–≥—Ä SDK
        function initYandexSDK() {
            YaGames
                .init()
                .then(_ysdk => {
                    ysdk = _ysdk;
                    console.log('Yandex SDK initialized');
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
                    return ysdk.getPlayer();
                })
                .then(_player => {
                    player = _player;
                    console.log('Player initialized', player);
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–≥—Ä–æ–∫–∞
                    loadPlayerProgress();
                })
                .catch(err => {
                    console.error('Error initializing Yandex SDK:', err);
                    // –ï—Å–ª–∏ SDK –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –±–µ–∑ –Ω–µ–≥–æ
                    initLoadingScreen();
                });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–≥—Ä–æ–∫–∞
        function loadPlayerProgress() {
            if (player) {
                player.getData(['maxUnlockedLevel', 'bestScore'])
                    .then(data => {
                        if (data.maxUnlockedLevel) {
                            maxUnlockedLevel = data.maxUnlockedLevel;
                        }
                        if (data.bestScore) {
                            bestScore = data.bestScore;
                        }
                        console.log('Player data loaded:', data);
                        
                        // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω
                        initLoadingScreen();
                    })
                    .catch(err => {
                        console.error('Error loading player data:', err);
                        initLoadingScreen();
                    });
            } else {
                initLoadingScreen();
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–≥—Ä–æ–∫–∞
        function savePlayerProgress() {
            if (player) {
                player.setData({
                    maxUnlockedLevel: maxUnlockedLevel,
                    bestScore: bestScore
                })
                .then(() => {
                    console.log('Player data saved');
                })
                .catch(err => {
                    console.error('Error saving player data:', err);
                });
            } else {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                localStorage.setItem('maxUnlockedLevel', maxUnlockedLevel);
                localStorage.setItem('bestScore', bestScore);
            }
        }
        
        // –ü–æ–∫–∞–∑ —Ä–µ–∫–ª–∞–º—ã
        function showAd() {
            if (ysdk) {
                ysdk.adv.showFullscreenAdv({
                    callbacks: {
                        onClose: () => {
                            console.log('Ad closed');
                        },
                        onError: (e) => {
                            console.error('Ad error:', e);
                        },
                        onOffline: () => {
                            console.log('Ad offline');
                        }
                    }
                });
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function initEventListeners() {
            startButton.addEventListener('click', () => {
                startScreen.style.display = 'none';
                levelMenu.style.display = 'block';
                createLevelMenu();
            });
            
            backToMenuButton.addEventListener('click', () => {
                levelMenu.style.display = 'none';
                startScreen.style.display = 'block';
            });
            
            pauseButton.addEventListener('click', togglePause);
            
            restartButton.addEventListener('click', () => {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –∑–∞–Ω–æ–≤–æ?')) {
                    initGame();
                }
            });
            
            restartModalButton.addEventListener('click', () => {
                showAd(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–ª–∞–º—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
                initGame();
            });
            
            nextLevelButton.addEventListener('click', () => {
                showAd(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–ª–∞–º—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
                if (currentLevel < 20) {
                    startLevel(currentLevel + 1);
                }
            });
            
            backToLevelsButton.addEventListener('click', () => {
                gameScreen.style.display = 'none';
                levelMenu.style.display = 'block';
                createLevelMenu();
            });
            
            backToLevelsFromVictoryButton.addEventListener('click', () => {
                gameScreen.style.display = 'none';
                levelMenu.style.display = 'block';
                createLevelMenu();
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!gameRunning) return;
                    
                    const dir = btn.getAttribute('data-direction');
                    bufferInput(dir);
                });
            });
        }
        
        // –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function bufferInput(dir) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ —Ç–µ–∫—É—â–µ–º—É
            if (
                (dir === 'up' && direction !== 'down') ||
                (dir === 'down' && direction !== 'up') ||
                (dir === 'left' && direction !== 'right') ||
                (dir === 'right' && direction !== 'left')
            ) {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä, –µ—Å–ª–∏ –µ–≥–æ —Ç–∞–º –µ—â–µ –Ω–µ—Ç
                if (!inputBuffer.includes(dir)) {
                    inputBuffer.push(dir);
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –¥–æ 3 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    if (inputBuffer.length > 3) {
                        inputBuffer.shift();
                    }
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
        function initLoadingScreen() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = `${progress}%`;
                loadingPercentage.textContent = `${Math.round(progress)}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingScreen.classList.add('loading-hidden');
                        startScreen.style.display = 'block';
                        initEventListeners();
                    }, 500);
                }
            }, 100);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é —É—Ä–æ–≤–Ω–µ–π
        function createLevelMenu() {
            levelsGrid.innerHTML = '';
            
            for (let i = 1; i <= 20; i++) {
                const levelButton = document.createElement('div');
                levelButton.className = 'level-button';
                levelButton.textContent = i;
                
                if (i <= maxUnlockedLevel) {
                    levelButton.classList.add('unlocked');
                    levelButton.addEventListener('click', () => startLevel(i));
                } else {
                    levelButton.classList.add('locked');
                }
                
                levelsGrid.appendChild(levelButton);
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        function createGrid() {
            canvas = document.getElementById('game-canvas');
            if (!canvas) return;
            
            ctx = canvas.getContext('2d');
            if (!ctx) return;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
            const boardSize = Math.min(gameBoard.clientWidth, gameBoard.clientHeight);
            canvas.width = boardSize;
            canvas.height = boardSize;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–ª–µ—Ç–∫–∏
            cellSize = boardSize / gridSize;
            
            board = [];
            for (let row = 0; row < gridSize; row++) {
                board[row] = [];
                for (let col = 0; col < gridSize; col++) {
                    board[row][col] = null;
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã –∑–º–µ–π–∫–∏
            snakeGrid = [];
            for (let row = 0; row < gridSize; row++) {
                snakeGrid[row] = [];
                for (let col = 0; col < gridSize; col++) {
                    snakeGrid[row][col] = false;
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            obstacleGrid = [];
            for (let row = 0; row < gridSize; row++) {
                obstacleGrid[row] = [];
                for (let col = 0; col < gridSize; col++) {
                    obstacleGrid[row][col] = false;
                }
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω—è
        function generateObstacles() {
            const config = levelConfig[currentLevel - 1];
            obstacles = [];
            
            // –û—á–∏—â–∞–µ–º –º–∞—Ç—Ä–∏—Ü—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    obstacleGrid[row][col] = false;
                }
            }
            
            // –†–∞–∑–º–µ—â–∞–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            for (const obstacle of config.obstacles) {
                if (obstacle.row < gridSize && obstacle.col < gridSize) {
                    obstacleGrid[obstacle.row][obstacle.col] = true;
                    obstacles.push({ row: obstacle.row, col: obstacle.col });
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –¥–ª—è —É—Ä–æ–≤–Ω—è
        function initGame() {
            const config = levelConfig[currentLevel - 1];
            gridSize = config.gridSize;
            
            createGrid();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–º–µ–π–∫–∏ –≤ —Ü–µ–Ω—Ç—Ä–µ –ø–æ–ª—è
            const center = Math.floor(gridSize / 2);
            snake = [
                { 
                    x: center * cellSize + cellSize / 2, 
                    y: center * cellSize + cellSize / 2,
                    targetX: center * cellSize + cellSize / 2,
                    targetY: center * cellSize + cellSize / 2
                },
                { 
                    x: (center - 1) * cellSize + cellSize / 2, 
                    y: center * cellSize + cellSize / 2,
                    targetX: (center - 1) * cellSize + cellSize / 2,
                    targetY: center * cellSize + cellSize / 2
                }
            ];
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π
            targetPositions = snake.map(segment => ({
                x: segment.x,
                y: segment.y
            }));
            
            direction = 'right';
            nextDirection = 'right';
            score = 0;
            gameRunning = true;
            gamePaused = false;
            moveProgress = 0;
            headMoveProgress = 0;
            isMoving = false;
            pendingAppleCheck = false;
            pendingVictoryCheck = false;
            inputBuffer = [];
            
            scoreElement.textContent = score;
            currentLevelElement.textContent = currentLevel;
            gameOverModal.style.display = 'none';
            victoryModal.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—Ä–∏—Ü—É –∑–º–µ–π–∫–∏
            updateSnakeGrid();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            generateObstacles();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ —è–±–ª–æ–∫–∏
            addRandomApple();
            addRandomApple();
            addRandomApple();
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–º–µ–π–∫—É
            drawGame();
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
            if (gameInterval !== null) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            if (animationInterval !== null) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
            gameInterval = setInterval(gameLoop, gameSpeed);
            animationInterval = setInterval(animateSnake, animationSpeed);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã –∑–º–µ–π–∫–∏
        function updateSnakeGrid() {
            // –û—á–∏—â–∞–µ–º –º–∞—Ç—Ä–∏—Ü—É –∑–º–µ–π–∫–∏
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    snakeGrid[row][col] = false;
                }
            }
            
            // –û—Ç–º–µ—á–∞–µ–º –∫–ª–µ—Ç–∫–∏, –∑–∞–Ω—è—Ç—ã–µ –∑–º–µ–π–∫–æ–π
            for (const segment of snake) {
                const col = Math.floor(segment.targetX / cellSize);
                const row = Math.floor(segment.targetY / cellSize);
                if (row >= 0 && row < gridSize && col >= 0 && col < gridSize) {
                    snakeGrid[row][col] = true;
                }
            }
        }
        
        // –ù–∞—á–∞–ª–æ —É—Ä–æ–≤–Ω—è
        function startLevel(level) {
            currentLevel = level;
            levelMenu.style.display = 'none';
            gameScreen.style.display = 'block';
            initGame();
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameRunning || gamePaused || isMoving) return;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ –±—É—Ñ–µ—Ä–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (inputBuffer.length > 0) {
                nextDirection = inputBuffer.shift();
            }
            
            direction = nextDirection;
            moveSnakeLogic();
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –∑–º–µ–π–∫–∏
        function animateSnake() {
            if (!gameRunning || gamePaused) return;
            
            // –ï—Å–ª–∏ –∑–º–µ–π–∫–∞ –¥–≤–∏–∂–µ—Ç—Å—è, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            if (isMoving) {
                moveProgress += animationSpeed / gameSpeed;
                headMoveProgress += (animationSpeed / gameSpeed) * 1.8; // –ì–æ–ª–æ–≤–∞ –¥–≤–∏–∂–µ—Ç—Å—è –≤ 1.8 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ
                
                if (headMoveProgress > 1) {
                    headMoveProgress = 1; // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≥–æ–ª–æ–≤—É
                }
                
                if (moveProgress >= 1) {
                    moveProgress = 1;
                    headMoveProgress = 1;
                    isMoving = false;
                    
                    // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥–∏
                    if (pendingAppleCheck) {
                        checkApple();
                        pendingAppleCheck = false;
                    }
                    
                    if (pendingVictoryCheck) {
                        checkVictory();
                        pendingVictoryCheck = false;
                    }
                }
            }
            
            // –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∑–º–µ–π–∫–∏
            // –ì–æ–ª–æ–≤–∞ –¥–≤–∏–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
            const head = snake[0];
            const headTarget = targetPositions[0];
            head.x = head.x + (headTarget.x - head.x) * headMoveProgress;
            head.y = head.y + (headTarget.y - head.y) * headMoveProgress;
            
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã –¥–≤–∏–≥–∞—é—Ç—Å—è —Å –æ–±—ã—á–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é
            for (let i = 1; i < snake.length; i++) {
                const segment = snake[i];
                const target = targetPositions[i];
                segment.x = segment.x + (target.x - segment.x) * moveProgress;
                segment.y = segment.y + (target.y - segment.y) * moveProgress;
            }
            
            drawGame();
        }
        
        // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–º–µ–π–∫–∏
        function moveSnakeLogic() {
            const head = { ...snake[0] };
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≥–æ–ª–æ–≤—ã
            switch (direction) {
                case 'up': head.targetY -= cellSize; break;
                case 'down': head.targetY += cellSize; break;
                case 'left': head.targetX -= cellSize; break;
                case 'right': head.targetX += cellSize; break;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏
            if (head.targetX < 0 || head.targetX >= gridSize * cellSize || 
                head.targetY < 0 || head.targetY >= gridSize * cellSize) {
                gameOver();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
            const headCellX = Math.floor(head.targetX / cellSize);
            const headCellY = Math.floor(head.targetY / cellSize);
            
            if (headCellX >= 0 && headCellX < gridSize && 
                headCellY >= 0 && headCellY < gridSize && 
                obstacleGrid[headCellY][headCellX]) {
                gameOver();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–∞–º–æ–π —Å–æ–±–æ–π
            if (headCellX >= 0 && headCellX < gridSize && 
                headCellY >= 0 && headCellY < gridSize && 
                snakeGrid[headCellY][headCellX]) {
                gameOver();
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–ª–µ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            targetPositions = [];
            for (let i = 0; i < snake.length; i++) {
                targetPositions.push({
                    x: snake[i].targetX,
                    y: snake[i].targetY
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≥–æ–ª–æ–≤—É
            snake.unshift(head);
            targetPositions.unshift({ x: head.targetX, y: head.targetY });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—Ä–∏—Ü—É –∑–º–µ–π–∫–∏ –¥–ª—è –Ω–æ–≤–æ–π –≥–æ–ª–æ–≤—ã
            const newHeadCellX = Math.floor(head.targetX / cellSize);
            const newHeadCellY = Math.floor(head.targetY / cellSize);
            if (newHeadCellX >= 0 && newHeadCellX < gridSize && 
                newHeadCellY >= 0 && newHeadCellY < gridSize) {
                snakeGrid[newHeadCellY][newHeadCellX] = true;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —è–±–ª–æ–∫–æ –≤ –Ω–æ–≤–æ–π –∫–ª–µ—Ç–∫–µ
            const cellX = Math.floor(head.targetX / cellSize);
            const cellY = Math.floor(head.targetY / cellSize);
            const hasApple = board[cellY] && board[cellY][cellX] !== null;
            
            if (hasApple) {
                // –ó–º–µ–π–∫–∞ —Å—ä–µ–ª–∞ —è–±–ª–æ–∫–æ, –Ω–æ –Ω–µ —É–¥–∞–ª—è–µ–º –µ–≥–æ —Å—Ä–∞–∑—É
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                pendingAppleCheck = true;
            } else {
                // –ó–º–µ–π–∫–∞ –Ω–µ —Å—ä–µ–ª–∞ —è–±–ª–æ–∫–æ, —É–¥–∞–ª—è–µ–º —Ö–≤–æ—Å—Ç
                const tail = snake.pop();
                targetPositions.pop();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—Ä–∏—Ü—É –∑–º–µ–π–∫–∏ –¥–ª—è —Ö–≤–æ—Å—Ç–∞
                const tailCellX = Math.floor(tail.targetX / cellSize);
                const tailCellY = Math.floor(tail.targetY / cellSize);
                if (tailCellX >= 0 && tailCellX < gridSize && 
                    tailCellY >= 0 && tailCellY < gridSize) {
                    snakeGrid[tailCellY][tailCellX] = false;
                }
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–≤–∏–∂–µ–Ω–∏—è
            isMoving = true;
            moveProgress = 0;
            headMoveProgress = 0;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —è–±–ª–æ–∫–∞ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
        function checkApple() {
            const head = snake[0];
            const cellX = Math.floor(head.targetX / cellSize);
            const cellY = Math.floor(head.targetY / cellSize);
            
            if (board[cellY] && board[cellY][cellX] !== null) {
                // –ó–º–µ–π–∫–∞ —Å—ä–µ–ª–∞ —è–±–ª–æ–∫–æ
                score += 10;
                scoreElement.textContent = score;
                
                // –£–¥–∞–ª—è–µ–º —è–±–ª–æ–∫–æ
                board[cellY][cellX] = null;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —è–±–ª–æ–∫–æ
                addRandomApple();
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–±–µ–¥—ã
                pendingVictoryCheck = true;
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —è–±–ª–æ–∫–∞
        function addRandomApple() {
            const emptyCells = [];
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–µ—Ç–∫–∞ —Å–≤–æ–±–æ–¥–Ω–∞ –∏ –Ω–µ –∑–∞–Ω—è—Ç–∞ –∑–º–µ–π–∫–æ–π –∏–ª–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ–º
                    if (board[row][col] === null && !snakeGrid[row][col] && !obstacleGrid[row][col]) {
                        emptyCells.push({ row, col });
                    }
                }
            }
            
            if (emptyCells.length > 0) {
                const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                board[randomCell.row][randomCell.col] = true;
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
        function drawGame() {
            if (!ctx) return;
            
            // –û—á–∏—â–∞–µ–º canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
            drawGrid();
            
            // –†–∏—Å—É–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            drawObstacles();
            
            // –†–∏—Å—É–µ–º —è–±–ª–æ–∫–∏
            drawApples();
            
            // –†–∏—Å—É–µ–º –∑–º–µ–π–∫—É
            drawSnake();
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏
        function drawGrid() {
            if (!ctx) return;
            
            ctx.strokeStyle = 'rgba(0, 153, 255, 0.1)';
            ctx.lineWidth = 1;
            
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let i = 1; i < gridSize; i++) {
                ctx.beginPath();
                ctx.moveTo(i * cellSize, 0);
                ctx.lineTo(i * cellSize, canvas.height);
                ctx.stroke();
            }
            
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let i = 1; i < gridSize; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * cellSize);
                ctx.lineTo(canvas.width, i * cellSize);
                ctx.stroke();
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function drawObstacles() {
            if (!ctx) return;
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    if (obstacleGrid[row][col]) {
                        const x = col * cellSize + cellSize / 2;
                        const y = row * cellSize + cellSize / 2;
                        const size = cellSize * 0.8;
                        
                        // –†–∏—Å—É–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –∫–∞–∫ –∫–≤–∞–¥—Ä–∞—Ç
                        ctx.fillStyle = '#ff5555';
                        ctx.fillRect(x - size/2, y - size/2, size, size);
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–º–∫—É
                        ctx.strokeStyle = '#ff0000';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(x - size/2, y - size/2, size, size);
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫—Ä–µ—Å—Ç–∏–∫
                        ctx.beginPath();
                        ctx.moveTo(x - size/3, y - size/3);
                        ctx.lineTo(x + size/3, y + size/3);
                        ctx.moveTo(x + size/3, y - size/3);
                        ctx.lineTo(x - size/3, y + size/3);
                        ctx.strokeStyle = '#ffffff';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                }
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —è–±–ª–æ–∫
        function drawApples() {
            if (!ctx) return;
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    if (board[row][col]) {
                        const x = col * cellSize + cellSize / 2;
                        const y = row * cellSize + cellSize / 2;
                        const radius = cellSize * 0.4;
                        
                        // –†–∏—Å—É–µ–º —è–±–ª–æ–∫–æ
                        ctx.beginPath();
                        ctx.arc(x, y, radius, 0, Math.PI * 2);
                        
                        // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —è–±–ª–æ–∫–∞
                        const gradient = ctx.createRadialGradient(
                            x - radius/3, y - radius/3, radius/4,
                            x, y, radius
                        );
                        gradient.addColorStop(0, '#ff6b6b');
                        gradient.addColorStop(1, '#c92a2a');
                        
                        ctx.fillStyle = gradient;
                        ctx.fill();
                        
                        // –ë–ª–µ—Å–∫ –Ω–∞ —è–±–ª–æ–∫–µ
                        ctx.beginPath();
                        ctx.arc(x - radius/3, y - radius/3, radius/4, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                        ctx.fill();
                        
                        // –õ–∏—Å—Ç–∏–∫
                        ctx.beginPath();
                        ctx.ellipse(x + radius/2, y - radius/2, radius/3, radius/5, Math.PI/4, 0, Math.PI * 2);
                        ctx.fillStyle = '#388e3c';
                        ctx.fill();
                    }
                }
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–º–µ–π–∫–∏ –±–µ–∑ —Ç–æ—Ä—á–∫–æ–≤ –ø—Ä–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ
        function drawSnake() {
            if (!ctx || snake.length === 0) return;
            
            // –†–∏—Å—É–µ–º —Ç–µ–ª–æ –∑–º–µ–π–∫–∏ –∫–∞–∫ –ø–ª–∞–≤–Ω—É—é –ª–∏–Ω–∏—é
            ctx.beginPath();
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å –≥–æ–ª–æ–≤—ã
            const head = snake[0];
            ctx.moveTo(head.x, head.y);
            
            // –†–∏—Å—É–µ–º –∫—Ä–∏–≤—É—é —á–µ—Ä–µ–∑ –≤—Å–µ —Å–µ–≥–º–µ–Ω—Ç—ã –∑–º–µ–π–∫–∏
            for (let i = 1; i < snake.length; i++) {
                const segment = snake[i];
                const prevSegment = snake[i - 1];
                
                // –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –∫—Ä–∏–≤–æ–π –ë–µ–∑—å–µ
                const cp1x = prevSegment.x + (segment.x - prevSegment.x) * 0.5;
                const cp1y = prevSegment.y + (segment.y - prevSegment.y) * 0.5;
                const cp2x = segment.x + (prevSegment.x - segment.x) * 0.5;
                const cp2y = segment.y + (prevSegment.y - segment.y) * 0.5;
                
                ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, segment.x, segment.y);
            }
            
            // –ó–∞–¥–∞–µ–º —Ç–æ–ª—â–∏–Ω—É –∏ —Å—Ç–∏–ª—å –∑–º–µ–π–∫–∏
            ctx.lineWidth = cellSize * 0.8;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Ç–µ–ª–∞ –∑–º–µ–π–∫–∏
            const gradient = ctx.createLinearGradient(
                snake[0].x, snake[0].y,
                snake[snake.length - 1].x, snake[snake.length - 1].y
            );
            gradient.addColorStop(0, '#ffffff');
            gradient.addColorStop(0.2, '#00ffcc');
            gradient.addColorStop(1, '#0099ff');
            
            ctx.strokeStyle = gradient;
            ctx.stroke();
            
            // –†–∏—Å—É–µ–º –≥–æ–ª–æ–≤—É –∑–º–µ–π–∫–∏ –ø–æ–≤–µ—Ä—Ö —Ç–µ–ª–∞
            ctx.beginPath();
            ctx.arc(head.x, head.y, cellSize * 0.45, 0, Math.PI * 2);
            
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –≥–æ–ª–æ–≤—ã
            const headGradient = ctx.createRadialGradient(
                head.x, head.y, 0,
                head.x, head.y, cellSize * 0.45
            );
            headGradient.addColorStop(0, '#ffffff');
            headGradient.addColorStop(1, '#00ffcc');
            
            ctx.fillStyle = headGradient;
            ctx.fill();
            
            // –ì–ª–∞–∑–∞
            const eyeSize = cellSize * 0.1;
            const eyeOffsetX = cellSize * 0.15;
            const eyeOffsetY = cellSize * 0.15;
            
            // –ü–æ–∑–∏—Ü–∏—è –≥–ª–∞–∑ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            let leftEyeX, leftEyeY, rightEyeX, rightEyeY;
            
            switch (direction) {
                case 'right':
                    leftEyeX = head.x + eyeOffsetX;
                    leftEyeY = head.y - eyeOffsetY;
                    rightEyeX = head.x + eyeOffsetX;
                    rightEyeY = head.y + eyeOffsetY;
                    break;
                case 'left':
                    leftEyeX = head.x - eyeOffsetX;
                    leftEyeY = head.y - eyeOffsetY;
                    rightEyeX = head.x - eyeOffsetX;
                    rightEyeY = head.y + eyeOffsetY;
                    break;
                case 'up':
                    leftEyeX = head.x - eyeOffsetX;
                    leftEyeY = head.y - eyeOffsetY;
                    rightEyeX = head.x + eyeOffsetX;
                    rightEyeY = head.y - eyeOffsetY;
                    break;
                case 'down':
                    leftEyeX = head.x - eyeOffsetX;
                    leftEyeY = head.y + eyeOffsetY;
                    rightEyeX = head.x + eyeOffsetX;
                    rightEyeY = head.y + eyeOffsetY;
                    break;
            }
            
            // –†–∏—Å—É–µ–º –≥–ª–∞–∑–∞
            ctx.beginPath();
            ctx.arc(leftEyeX, leftEyeY, eyeSize, 0, Math.PI * 2);
            ctx.fillStyle = '#000';
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(rightEyeX, rightEyeY, eyeSize, 0, Math.PI * 2);
            ctx.fillStyle = '#000';
            ctx.fill();
            
            // –ë–ª–∏–∫ –≤ –≥–ª–∞–∑–∞—Ö
            ctx.beginPath();
            ctx.arc(leftEyeX - eyeSize/3, leftEyeY - eyeSize/3, eyeSize/3, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(rightEyeX - eyeSize/3, rightEyeY - eyeSize/3, eyeSize/3, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã - –∑–º–µ–π–∫–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –í–°–ï –∫–ª–µ—Ç–∫–∏ –ø–æ–ª—è
        function checkVictory() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–º–µ–π–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –ø–æ–ª—è
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–ª–µ—Ç–∫—É, –Ω–µ –∑–∞–Ω—è—Ç—É—é –∑–º–µ–π–∫–æ–π - –Ω–µ –ø–æ–±–µ–¥–∞
                    if (!snakeGrid[row][col]) {
                        return;
                    }
                }
            }
            
            // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, –∑–Ω–∞—á–∏—Ç –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –∑–∞–Ω—è—Ç—ã –∑–º–µ–π–∫–æ–π - –ø–æ–±–µ–¥–∞!
            victory();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–±–µ–¥—ã
        function victory() {
            gameRunning = false;
            if (gameInterval !== null) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            if (animationInterval !== null) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
            
            victoryScoreElement.textContent = score;
            victoryModal.style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥
            if (score > bestScore) {
                bestScore = score;
                savePlayerProgress();
            }
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
            if (currentLevel === maxUnlockedLevel && currentLevel < 20) {
                maxUnlockedLevel++;
                savePlayerProgress();
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å", –µ—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
            if (currentLevel >= 20) {
                nextLevelButton.style.display = 'none';
            } else {
                nextLevelButton.style.display = 'block';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        function gameOver() {
            gameRunning = false;
            if (gameInterval !== null) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            if (animationInterval !== null) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
            
            finalScoreElement.textContent = score;
            gameOverModal.style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥
            if (score > bestScore) {
                bestScore = score;
                savePlayerProgress();
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            switch (e.key) {
                case 'ArrowUp':
                    bufferInput('up');
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    bufferInput('down');
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    bufferInput('left');
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    bufferInput('right');
                    e.preventDefault();
                    break;
                case ' ':
                    togglePause();
                    e.preventDefault();
                    break;
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
        let touchStartX = 0;
        let touchStartY = 0;
        
        document.addEventListener('touchstart', (e) => {
            if (e.target.closest('#game-canvas')) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }
        });
        
        document.addEventListener('touchend', (e) => {
            if (!gameRunning || !e.target.closest('#game-canvas')) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;
            
            if (Math.abs(dx) > Math.abs(dy)) {
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                if (dx > 0) {
                    bufferInput('right');
                } else {
                    bufferInput('left');
                }
            } else {
                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                if (dy > 0) {
                    bufferInput('down');
                } else {
                    bufferInput('up');
                }
            }
        });
        
        // –ü–∞—É–∑–∞ –∏–≥—Ä—ã
        function togglePause() {
            if (!gameRunning) return;
            
            gamePaused = !gamePaused;
            pauseButton.textContent = gamePaused ? '‚ñ∂' : '‚è∏';
        }
        
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ canvas –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞
        function resizeCanvas() {
            if (!canvas || !gameRunning) return;
            
            const boardSize = Math.min(gameBoard.clientWidth, gameBoard.clientHeight);
            canvas.width = boardSize;
            canvas.height = boardSize;
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–ª–µ—Ç–∫–∏
            cellSize = boardSize / gridSize;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∑–º–µ–π–∫–∏
            for (let i = 0; i < snake.length; i++) {
                const segment = snake[i];
                const cellX = Math.floor(segment.x / cellSize);
                const cellY = Math.floor(segment.y / cellSize);
                segment.x = cellX * cellSize + cellSize / 2;
                segment.y = cellY * cellSize + cellSize / 2;
                segment.targetX = segment.x;
                segment.targetY = segment.y;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–ª–µ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏
            targetPositions = snake.map(segment => ({
                x: segment.x,
                y: segment.y
            }));
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–≥—Ä—É
            drawGame();
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', resizeCanvas);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            initDOMElements();
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ø–Ω–¥–µ–∫—Å –ò–≥—Ä SDK
            initYandexSDK();
        });
    </script>
</body>
</html>